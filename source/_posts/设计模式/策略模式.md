---
layout: post
title: è¿˜åœ¨ç”¨if elseï¼Ÿç­–ç•¥æ¨¡å¼äº†è§£ä¸€ä¸‹ï¼
date: 2019-01-11 19:22:27
categories: è®¾è®¡æ¨¡å¼
tags:
- è®¾è®¡æ¨¡å¼
description: è¿˜åœ¨ç”¨if elseï¼Ÿç­–ç•¥æ¨¡å¼äº†è§£ä¸€ä¸‹ï¼
---

å°ç¼–åœ¨å…¬å¸è´Ÿè´£çš„å°±æ˜¯è®¢å•å–æ¶ˆä¸šåŠ¡ï¼Œè€ç³»ç»Ÿä¸­å„ç§ç±»å‹è®¢å•å–æ¶ˆéƒ½æ˜¯é€šè¿‡if else åˆ¤æ–­ä¸åŒçš„è®¢å•ç±»å‹è¿›è¡Œä¸åŒçš„é€»è¾‘ã€‚åœ¨ç»å†è€ç³»ç»Ÿçš„æŠ˜ç£¨å’Œäº§å“éœ€æ±‚çš„ä¸æ–­å˜æ›´ï¼Œå°ç¼–å†³å®šè¿›è¡Œä¸€æ¬¡å¤§çš„é‡æ„ï¼šæ¶ˆç­ if elseã€‚

æ¥ä¸‹æ¥å°±å‘å¤§å®¶ä»‹ç»ä¸‹æ˜¯å¦‚ä½•æ¶ˆç­ if elseã€‚
## 1. if elseæ¨¡å¼
```java
@Service
public class CancelOrderService {

    public void process(OrderDTO orderDTO) {
        int serviceType = orderDTO.getServiceType();
        if (1 == serviceType) {
            System.out.println("å–æ¶ˆå³æ—¶è®¢å•");
        } else if (2 == serviceType) {
            System.out.println("å–æ¶ˆé¢„çº¦è®¢å•");
        } else if (3 == serviceType) {
            System.out.println("å–æ¶ˆæ‹¼è½¦è®¢å•");
        }
    }
}
```
è‹¥å¹²ä¸ªæœˆå†æ¥çœ‹å°±æ˜¯è¿™æ ·çš„æ„Ÿè§‰
![](http://i1.go2yd.com/image.php?url=0KDCiIBwkf)

## 2. ç­–ç•¥æ¨¡å¼
### 2.1 ç­–ç•¥æ¨¡å¼å®ç°çš„Service
```java
@Service
public class CancelOrderStrategyService {

    @Autowired
    private StrategyContext context;

    public void process(OrderDTO orderDTO) {
        OrderTypeEnum orderTypeEnum = OrderTypeEnum.getByCode(orderDTO.getServiceType());
        AbstractStrategy strategy = context.getStrategy(orderTypeEnum);
        strategy.process(orderDTO);
    }
}
```
ç®€æ´çš„æœ‰ç‚¹è¿‡åˆ†äº†æ˜¯ä¸æ˜¯!!!

### 2.2 å„ç§ç±»å‹ç­–ç•¥å®ç°åŠæŠ½è±¡ç­–ç•¥ç±»
ä¸‹é¢é€‰å–äº†å³æ—¶è®¢å•å’Œé¢„çº¦è®¢å•çš„ç­–ç•¥.
```java
@Service
@OrderTypeAnnotation(orderType = OrderTypeEnum.INSTANT)
public class InstantOrderStrategy extends AbstractStrategy {
    @Override
    public void process(OrderDTO orderDTO) {
        System.out.println("å–æ¶ˆå³æ—¶è®¢å•");
    }
}
```
```java
@Service
@OrderTypeAnnotation(orderType = OrderTypeEnum.BOOKING)
public class BookingOrderStrategy extends AbstractStrategy {
    @Override
    public void process(OrderDTO orderDTO) {
        System.out.println("å–æ¶ˆé¢„çº¦è®¢å•");
    }
}
```
```java
public abstract class AbstractStrategy {
    abstract public void process(OrderDTO orderDTO);
}
```
### 2.3 ç­–ç•¥ç±»å‹æ³¨è§£
æ¯ä¸ªç­–ç•¥ä¸­å¢åŠ äº†æ³¨è§£OrderTypeAnnotation,ä»¥æ ‡æ³¨é€‚ç”¨äºä¸åŒç±»å‹çš„ç­–ç•¥å†…å®¹.
```java
@Target({ElementType.TYPE})
@Retention(RetentionPolicy.RUNTIME)
@Documented
@Inherited
public @interface OrderTypeAnnotation {
    OrderTypeEnum orderType();
}
```

### 2.4 ç­–ç•¥å¤„ç†å™¨ç±»StrategyProcessorå’Œç­–ç•¥ä¸Šä¸‹æ–‡StrategyContext
å…¶ä¸­æœ€ä¸ºæ ¸å¿ƒçš„ä¸ºStrategyProcessor ç­–ç•¥å¤„ç†å™¨ç±»å’ŒStrategyContext ç­–ç•¥ä¸Šä¸‹æ–‡,

```java
@Component
public class StrategyProcessor implements BeanFactoryPostProcessor {

    private static final String STRATEGY_PACKAGE = "com.lujiahao.strategy";

    @Override
    public void postProcessBeanFactory(ConfigurableListableBeanFactory configurableListableBeanFactory) throws BeansException {
        Map<OrderTypeEnum, Class> handlerMap = Maps.newHashMapWithExpectedSize(3);
        ClassScanner.scan(STRATEGY_PACKAGE, OrderTypeAnnotation.class).forEach(clazz -> {
            OrderTypeEnum type = clazz.getAnnotation(OrderTypeAnnotation.class).orderType();
            handlerMap.put(type, clazz);
        });

        StrategyContext context = new StrategyContext(handlerMap);
        configurableListableBeanFactory.registerSingleton(StrategyContext.class.getName(), context);
    }
}
```
```java
public class StrategyContext {
    private Map<OrderTypeEnum, Class> strategyMap;

    public StrategyContext(Map<OrderTypeEnum, Class> strategyMap) {
        this.strategyMap = strategyMap;
    }

    public AbstractStrategy getStrategy(OrderTypeEnum orderTypeEnum) {
        if (orderTypeEnum == null) {
            throw new IllegalArgumentException("not fond enum");
        }

        if (CollectionUtils.isEmpty(strategyMap)) {
            throw new IllegalArgumentException("strategy map is empty,please check you strategy package path");
        }

        Class clazz = strategyMap.get(orderTypeEnum);
        if (clazz == null) {
            throw new IllegalArgumentException("not fond strategy for type:" + orderTypeEnum.getCode());
        }

        return (AbstractStrategy) SpringBeanUtils.getBean(clazz);
    }
}
```

- é¦–å…ˆä¼šæ‰«ææŒ‡å®šåŒ…ä¸­æ ‡æœ‰@OrderTypeAnnotationçš„ç±»
- å°†ç¬¦åˆç±»çš„å¯¹åº”çš„æšä¸¾å€¼ä½œä¸ºkeyï¼Œå¯¹åº”çš„ç±»ä½œä¸ºvalueï¼Œä¿å­˜åœ¨ç­–ç•¥Mapä¸­
- åˆå§‹åŒ–StrategyContext,å¹¶æ³¨å†Œåˆ°springå®¹å™¨ä¸­,åŒæ—¶å°†ç­–ç•¥Mapä¼ å…¥å…¶ä¸­

> æˆ‘ä»¬ä½¿ç”¨äº†æšä¸¾ä½œä¸ºMapä¸­çš„key,ç›¸ä¿¡å¤§å®¶å¾ˆå°‘æœ‰äººè¿™æ ·æ“ä½œè¿‡,ä¸è¿‡å¯ä»¥æ”¾å¿ƒæ“ä½œ.é€šè¿‡ä¸‹é¢ä¸¤ç¯‡æ–‡ç« è§£ç­”å¤§å®¶çš„ç–‘é—®.
> - [è‡ªå®šä¹‰æšä¸¾ç±» Enum æ˜¯å¦å¯ä»¥ä½œä¸º HashMap çš„key](https://blog.csdn.net/dalinsi/article/details/53064843)
> - [Java åœ¨ Map ä¸­ä½¿ç”¨å¤æ‚æ•°æ®ç±»å‹ä½œä¸º Key](https://blog.csdn.net/zhuchunyan_aijia/article/details/81000065)

## 3. æ€»ç»“
ç­–ç•¥æ¨¡å¼æå¤§çš„å‡å°‘if elseç­‰æ¨¡æ¿ä»£ç ,åœ¨æå‡ä»£ç å¯è¯»æ€§çš„åŒæ—¶,ä¹Ÿå¤§å¤§å¢åŠ ä»£ç çš„çµæ´»æ€§,æ·»åŠ æ–°çš„ç­–ç•¥å³å¯ä»¥æ»¡è¶³ä¸šåŠ¡éœ€æ±‚.
æœ¬äººåœ¨æˆ‘å¸ä¸šåŠ¡ä¸­å¯¹ç­–ç•¥æ¨¡å¼çš„åº”ç”¨å¾—åˆ°äº†å¾ˆå¥½çš„éªŒè¯,ä»æ­¤å†ä¹Ÿä¸ç”¨æ‹…å¿ƒäº§å“æ”¹éœ€æ±‚.
ç”¨ç­–ç•¥æ¨¡å¼ä¸€æ—¶çˆ½,ä¸€ç›´ç”¨ä¸€ç›´çˆ½ğŸ˜!

## 4. ä»£ç 
[å®Œæ•´ä»£ç ](https://github.com/lujiahao0708/LearnSeries/tree/master/LearnDesignPattern/src/main/java/com/lujiahao/strategy)

----
æ¬¢è¿å¤§å®¶å…³æ³¨ğŸ˜
![](https://raw.githubusercontent.com/lujiahao0708/PicRepo/master/%E5%85%AC%E4%BC%97%E5%8F%B7%E4%BA%8C%E7%BB%B4%E7%A0%81.jpg)

