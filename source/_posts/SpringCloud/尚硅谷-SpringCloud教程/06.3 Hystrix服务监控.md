---
title: 06.3 Hystrix服务监控
date: 2019-09-04 19:04:47
categories: SpringCloud
tags:
- SpringCloud
- Spring
---

> 除了隔离依赖服务的调用以外，Hystrix还提供了准实时的调用监控（Hystrix Dashboard），Hystrix会持续地记录所有通过Hystrix发起的请求的执行信息，并以统计报表和图形的形式展示给用户，包括每秒执行多少请求多少成功，多少失败等。Netflix通过hystrix-metrics-event-stream项目实现了对以上指标的监控。Spring Cloud也提供了Hystrix Dashboard的整合，对监控内容转化成可视化界面。 

<!--more-->

## 1.  新建工程
microservicecloud-consumer-hystrix-dashboard

## 2. pom.xml文件

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0https://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>

    <parent>
        <groupId>com.hellodev</groupId>
        <artifactId>atguigu-microservicecloud</artifactId>
        <version>0.0.1</version>
    </parent>

    <artifactId>microservicecloud-consumer-hystrix-dashboard-9001</artifactId>
    <version>0.0.1</version>

    <dependencies>
        <!--自己定义的api -->
        <dependency>
            <groupId>com.hellodev</groupId>
            <artifactId>microservicecloud-api</artifactId>
            <version>${project.version}</version>
        </dependency>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-web</artifactId>
        </dependency>
        <!--修改后立即生效，热部署-->
        <dependency>
            <groupId>org.springframework</groupId>
            <artifactId>springloaded</artifactId>
        </dependency>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-devtools</artifactId>
        </dependency>
        <!--Ribbon相关-->
        <dependency>
            <groupId>org.springframework.cloud</groupId>
            <artifactId>spring-cloud-starter-eureka</artifactId>
        </dependency>
        <dependency>
            <groupId>org.springframework.cloud</groupId>
            <artifactId>spring-cloud-starter-ribbon</artifactId>
        </dependency>
        <dependency>
            <groupId>org.springframework.cloud</groupId>
            <artifactId>spring-cloud-starter-config</artifactId>
        </dependency>
        <!--feign相关-->
        <dependency>
            <groupId>org.springframework.cloud</groupId>
            <artifactId>spring-cloud-starter-feign</artifactId>
        </dependency>
        <!-- hystrix和 hystrix-dashboard相关-->
        <dependency>
            <groupId>org.springframework.cloud</groupId>
            <artifactId>spring-cloud-starter-hystrix</artifactId>
        </dependency>
        <dependency>
            <groupId>org.springframework.cloud</groupId>
            <artifactId>spring-cloud-starter-hystrix-dashboard</artifactId>
        </dependency>
    </dependencies>
</project>
```

## 3. yml文件

```yaml
server:
  port: 9001
```

## 4. 主启动类

```java
@SpringBootApplication
@EnableHystrixDashboard
public class ConsumerHystrixDashboard9001Application {
   public static void main(String[] args) {
      SpringApplication.run(ConsumerHystrixDashboard9001Application.class, args);
   }
}
```

## 5.  Provider微服务监控
所有Provider微服务提供类(8001/8002/8003)都需要监控依赖配置
检查是否都有监控配置
```xml
<!-- actuator监控信息完善 -->
<dependency>
   <groupId>org.springframework.boot</groupId>
   <artifactId>spring-boot-starter-actuator</artifactId>
</dependency>
```

## 6.  启动microservicecloud-consumer-hystrix-dashboard
访问	http://localhost:9001/hystrix

![](https://raw.githubusercontent.com/lujiahao0708/PicRepo/master/blogPic/SpringCloud/%E5%B0%9A%E7%A1%85%E8%B0%B7-SpringCloud%E6%95%99%E7%A8%8B/06.3%20Hystrix%E6%9C%8D%E5%8A%A1%E7%9B%91%E6%8E%A7/1.Hystrix-dashboard.png)

## 7. 验证
启动Eureka集群, 再启动microservicecloud-provider-dept-hystrix-8001,访问
```jshelllanguage
curl http://localhost:8001/dept/get/1
{
    "deptno": 1,
    "dname": "开发部",
    "db_source": "cloudDB01"
}
```

http://localhost:8001/hystrix.stream

![](https://raw.githubusercontent.com/lujiahao0708/PicRepo/master/blogPic/SpringCloud/%E5%B0%9A%E7%A1%85%E8%B0%B7-SpringCloud%E6%95%99%E7%A8%8B/06.3%20Hystrix%E6%9C%8D%E5%8A%A1%E7%9B%91%E6%8E%A7/2.stream.png)

## 8. 监控界面
### 8.1 填写监控地址

![](https://raw.githubusercontent.com/lujiahao0708/PicRepo/master/blogPic/SpringCloud/%E5%B0%9A%E7%A1%85%E8%B0%B7-SpringCloud%E6%95%99%E7%A8%8B/06.3%20Hystrix%E6%9C%8D%E5%8A%A1%E7%9B%91%E6%8E%A7/3.png)

- Delay：该参数用来控制服务器上轮询监控信息的延迟时间，默认为2000毫秒，可以通过配置该属性来降低客户端的网络和CPU消耗。 
- Title：该参数对应了头部标题Hystrix Stream之后的内容，默认会使用具体监控实例的URL，可以通过配置该信息来展示更合适的标题。
  
### 8.2 监控界面
![](https://raw.githubusercontent.com/lujiahao0708/PicRepo/master/blogPic/SpringCloud/%E5%B0%9A%E7%A1%85%E8%B0%B7-SpringCloud%E6%95%99%E7%A8%8B/06.3%20Hystrix%E6%9C%8D%E5%8A%A1%E7%9B%91%E6%8E%A7/4.png)


- 实心圆 : 共有两种含义。它通过颜色的变化代表了实例的健康程度，它的健康度从绿色<黄色<橙色<红色递减。该实心圆除了颜色的变化之外，它的大小也会根据实例的请求流量发生变化，流量越大该实心圆就越大。所以通过该实心圆的展示，就可以在大量的实例中快速的发现 故障实例和高压力实例。 
- 曲线 : 用来记录2分钟内流量的相对变化，可以通过它来观察到流量的上升和下降趋势。 

整体说明
![](https://raw.githubusercontent.com/lujiahao0708/PicRepo/master/blogPic/SpringCloud/%E5%B0%9A%E7%A1%85%E8%B0%B7-SpringCloud%E6%95%99%E7%A8%8B/06.3%20Hystrix%E6%9C%8D%E5%8A%A1%E7%9B%91%E6%8E%A7/5.png)

![](https://raw.githubusercontent.com/lujiahao0708/PicRepo/master/blogPic/SpringCloud/%E5%B0%9A%E7%A1%85%E8%B0%B7-SpringCloud%E6%95%99%E7%A8%8B/06.3%20Hystrix%E6%9C%8D%E5%8A%A1%E7%9B%91%E6%8E%A7/6.png)

动图演示:
多次刷新http://localhost:8001/dept/get/1
![](https://raw.githubusercontent.com/lujiahao0708/PicRepo/master/blogPic/SpringCloud/%E5%B0%9A%E7%A1%85%E8%B0%B7-SpringCloud%E6%95%99%E7%A8%8B/06.3%20Hystrix%E6%9C%8D%E5%8A%A1%E7%9B%91%E6%8E%A7/7.Hystrix%E7%9B%91%E6%8E%A7%E6%BC%94%E7%A4%BA.gif)




## 资源获取
公众号回复 : Hystrix服务监控 获取本节代码

公众号回复 : SpringCloud思维导图

## Tips
欢迎收藏和转发，感谢你的支持！(๑•̀ㅂ•́)و✧ 

欢迎关注我的公众号：后端小哥，专注后端开发，希望和你一起进步！

![](https://github.com/lujiahao0708/PicRepo/raw/master/公众号二维码.jpg)
