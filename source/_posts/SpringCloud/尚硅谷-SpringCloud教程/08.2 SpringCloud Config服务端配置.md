---
title: 08.2 SpringCloud Config服务端配置
categories: SpringCloud
tags:
  - SpringCloud
  - Spring
abbrlink: c9becfd2
date: 2019-09-07 19:04:47
---

SpringCloud Config服务端配置

<!--more-->

# 1. Git托管配置文件
本文使用Github私有仓库来实现,创建过程略(配置文件为敏感数据,尽量使用私有仓库模式)

![](https://raw.githubusercontent.com/lujiahao0708/PicRepo/master/blogPic/SpringCloud/%E5%B0%9A%E7%A1%85%E8%B0%B7-SpringCloud%E6%95%99%E7%A8%8B/08.2%20SpringCloud%20Config%E6%9C%8D%E5%8A%A1%E7%AB%AF%E9%85%8D%E7%BD%AE/1.png)

创建完成后添加文件 application.yml文件

```yaml
spring:
  profiles:
    active:
      - dev
---
spring:
  #开发环境
  profiles: dev
  application:
    name: microservicecloud-config-atguigu-dev
---
spring:
  #测试环境
  profiles: test
  application:
    name: microservicecloud-config-atguigu-test
#请保存为UTF-8格式
```

# 2. 服务端配置
## 2.1  新建Module模块microservicecloud-config-3344
它即为Cloud的配置中心模块

## 2.2 pom.xml文件

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>

    <parent>
        <groupId>com.hellodev</groupId>
        <artifactId>atguigu-microservicecloud</artifactId>
        <version>0.0.1</version>
    </parent>

    <artifactId>microservicecloud-config-3344</artifactId>
    <version>0.0.1</version>

    <dependencies>
        <dependency><!-- 引入自己定义的 api 通用包，可以使用 Dept 部门Entity -->
            <groupId>com.hellodev</groupId>
            <artifactId>microservicecloud-api</artifactId>
            <version>${project.version}</version>
        </dependency>

        <!-- springCloud Config-->
        <dependency>
            <groupId>org.springframework.cloud</groupId>
            <artifactId>spring-cloud-config-server</artifactId>
        </dependency>

        <!-- 避免 Config 的 Git 插件报错： org /eclipse/ jgit / api /TransportConfigCallback  -->
        <dependency>
            <groupId>org.eclipse.jgit</groupId>
            <artifactId>org.eclipse.jgit</artifactId>
            <version>4.10.0.201712302008-r</version>
        </dependency>

        <!--hystrix-->
        <dependency>
            <groupId>org.springframework.cloud</groupId>
            <artifactId>spring-cloud-starter-hystrix</artifactId>
        </dependency>

        <!-- 将微服务provider侧注册进 eureka  -->
        <dependency>
            <groupId>org.springframework.cloud</groupId>
            <artifactId>spring-cloud-starter-eureka</artifactId>
        </dependency>
        <dependency>
            <groupId>org.springframework.cloud</groupId>
            <artifactId>spring-cloud-starter-config</artifactId>
        </dependency>
        <!-- actuator监控信息完善 -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-actuator</artifactId>
        </dependency>

        <dependency>
            <groupId>junit</groupId>
            <artifactId>junit</artifactId>
        </dependency>

        <dependency>
            <groupId>ch.qos.logback</groupId>
            <artifactId>logback-core</artifactId>
        </dependency>

        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-jetty</artifactId>
        </dependency>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-web</artifactId>
        </dependency>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-test</artifactId>
        </dependency>
        <!-- 修改后立即生效，热部署 -->
        <dependency>
            <groupId>org.springframework</groupId>
            <artifactId>springloaded</artifactId>
        </dependency>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-devtools</artifactId>
        </dependency>
    </dependencies>
</project>
```

## 2.3 yml文件

```yaml
server:
  port: 3344
spring:
  application:
    name: microservicecloud-config
  cloud:
    config:
      server:
        git:
          #GitHub上面的git仓库名字
          uri: git@github.com:lujiahao0708/microservicecloud-config.git
```

## 2.4 主启动类

```java
@SpringBootApplication
@EnableConfigServer
public class Config3344Application {
    public static void main(String[] args) {
        SpringApplication.run(Config3344Application.class, args);
    }
}
```

## 2.5 hosts文件增加

```jshelllanguage
127.0.0.1  config-3344.com
```

## 2.6 验证
启动config-3344服务,访问url查看结果

![](https://raw.githubusercontent.com/lujiahao0708/PicRepo/master/blogPic/SpringCloud/%E5%B0%9A%E7%A1%85%E8%B0%B7-SpringCloud%E6%95%99%E7%A8%8B/08.2%20SpringCloud%20Config%E6%9C%8D%E5%8A%A1%E7%AB%AF%E9%85%8D%E7%BD%AE/2.png)

前两个分别为dev环境和test环境,最后一个为不存在的环境
# 3. 配置读取规则

    /{application}-{profile}.yml
        http://config-3344.com:3344/application-dev.yml
        http://config-3344.com:3344/application-test.yml
        http://config-3344.com:3344/application-xxx.yml(不存在的配置)
    /{application}/{profile}[/{label}]
        http://config-3344.com:3344/application/dev/master
        http://config-3344.com:3344/application/test/master
        http://config-3344.com:3344/application/xxx/master
    /{label}/{application}-{profile}.yml
        http://config-3344.com:3344/master/application-dev.yml
        http://config-3344.com:3344/master/application-test.yml



## 资源获取
公众号回复 : SpringCloud Config服务端配置 获取本节代码

公众号回复 : SpringCloud思维导图

## Tips
欢迎收藏和转发，感谢你的支持！(๑•̀ㅂ•́)و✧ 

欢迎关注我的公众号：后端小哥，专注后端开发，希望和你一起进步！

![](https://raw.githubusercontent.com/lujiahao0708/PicRepo/master/%E5%85%AC%E4%BC%97%E5%8F%B7%E4%BA%8C%E7%BB%B4%E7%A0%81.jpg)
