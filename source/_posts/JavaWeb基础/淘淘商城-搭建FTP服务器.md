---
title: 淘淘商城-搭建FTP服务器
date: 2016-11-02 11:16:07
categories: JavaEE
tags:
  - JavaEE
  - 淘淘商城
  - FTP
  - Linux
description: 使用VSFTP搭建FTP服务器笔记
---

## 1.前期准备
> 因为穷,所以使用的是VMware虚拟机来搭建

1. 安装CentOS虚拟机(如果你有服务器更好)
2. 准备IP地址(虚拟机内网 : 192.168.2.100),并配置好
3. 准备客户端连接软件(FileZilla/Xftp/EditPlus)

## 2.开始安装

### 2.1安装vsftpd组件
	[root@localhost ~]# yum -y install vsftpd
安装完后，有/etc/vsftpd/vsftpd.conf 文件，是vsftp的配置文件。

### 2.2添加一个ftp用户并设置密码
	[root@localhost ~]# useradd ftpuser
此用户就是用来登录ftp服务器用的。登录后默认的路径为 `/home/ftpuser`

	[root@localhost ~]# passwd ftpuser
输入两次密码后修改密码。  密码:123

### 2.3防火墙开启21端口
因为ftp默认的端口为21，而centos默认是没有开启的，所以要修改iptables文件

	[root@localhost ~]# vim /etc/sysconfig/iptables
在行上面有22 -j ACCEPT 下面另起一行输入跟那行差不多的，只是把22换成21，然后：wq保存。

修改后的内容如下:

	# Firewall configuration written by system-config-firewall
	# Manual customization of this file is not recommended.
	*filter
	:INPUT ACCEPT [0:0]
	:FORWARD ACCEPT [0:0]
	:OUTPUT ACCEPT [0:0]
	-A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT
	-A INPUT -p icmp -j ACCEPT
	-A INPUT -i lo -j ACCEPT
	-A INPUT -m state --state NEW -m tcp -p tcp --dport 21 -j ACCEPT
	-A INPUT -m state --state NEW -m tcp -p tcp --dport 22 -j ACCEPT
	-A INPUT -j REJECT --reject-with icmp-host-prohibited
	-A FORWARD -j REJECT --reject-with icmp-host-prohibited
	COMMIT

还要运行下,重启iptables防火墙

	[root@localhost ~]# service iptables restart

### 2.4修改selinux
外网是可以访问上去了，可是发现没法返回目录（使用ftp的主动模式，被动模式还是无法访问），也上传不了，因为selinux作怪了。

执行以下命令查看状态：

	[root@localhost ~]# getsebool -a | grep ftp  
	allow_ftpd_anon_write --> off
	allow_ftpd_full_access --> off
	allow_ftpd_use_cifs --> off
	allow_ftpd_use_nfs --> off
	ftp_home_dir --> off
	ftpd_connect_db --> off
	ftpd_use_passive_mode --> off
	httpd_enable_ftp_server --> off
	tftp_anon_write --> off

执行上面命令，再返回的结果看到`allow_ftpd_full_access`和ftp_home_dir两行都是off，代表，没有开启外网的访问

	[root@localhost ~]# setsebool -P allow_ftpd_full_access on
	[root@localhost ~]# setsebool -P ftp_home_dir on

这样应该没问题了（如果，还是不行，看看是不是用了ftp客户端工具用了passive模式访问了，如提示Entering Passive mode，就代表是passive模式，默认是不行的，因为ftp passive模式被iptables挡住了，下面会讲怎么开启，如果懒得开的话，就看看你客户端ftp是否有port模式的选项，或者把passive模式的选项去掉。如果客户端还是不行，看看客户端上的主机的电脑是否开了防火墙，关吧）

### 2.5关闭匿名访问

	[root@localhost ~]# vim /etc/vsftpd/vsftpd.conf

将`anonymous_enable=YES`改为`anonymous_enable=NO`

![3.关闭匿名访问.png](https://ooo.0o0.ooo/2016/11/02/58195d430483f.png)

重启ftp服务

	[root@localhost ~]# service vsftpd restart
### 2.6开启被动模式
默认是开启的，但是要指定一个端口范围，打开vsftpd.conf文件，在后面加上

	pasv_min_port=30000
	pasv_max_port=30999
表示端口范围为30000~30999，这个可以随意改。改完重启一下vsftpd
由于指定这段端口范围，iptables也要相应的开启这个范围，所以像上面那样打开iptables文件。
也是在21上下面另起一行，更那行差不多，只是把21 改为30000:30999,然后:wq保存

修改后的内容如下:

	# Generated by iptables-save v1.4.7 on Sat Sep  3 13:04:11 2016
	*filter
	:INPUT ACCEPT [0:0]
	:FORWARD ACCEPT [0:0]
	:OUTPUT ACCEPT [9:1116]
	-A INPUT -p tcp -m tcp --dport 22 -j ACCEPT
	-A INPUT -p tcp -m tcp --dport 21 -j ACCEPT
	-A INPUT -p tcp -m tcp --dport 30000:30999 -j ACCEPT
	-A INPUT -p tcp -m tcp --dport 80 -j ACCEPT
	-A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT
	-A INPUT -p icmp -j ACCEPT
	-A INPUT -i lo -j ACCEPT
	-A INPUT -p tcp -m state --state NEW -m tcp --dport 22 -j ACCEPT
	-A INPUT -j REJECT --reject-with icmp-host-prohibited
	-A FORWARD -j REJECT --reject-with icmp-host-prohibited
	COMMIT
	# Completed on Sat Sep  3 13:04:11 2016

重启iptables防火墙

	[root@localhost ~]# service iptables restart
### 2.7设置开机启动vsftpd ftp服务
	[root@localhost ~]# chkconfig vsftpd on

## 3.客户端连接工具介绍
### 3.1FileZilla
哈哈  这个没用过 虽然视频里面讲的是这个工具
### 3.2Xftp
一图胜千言
![QQ截图20161102120402.png](https://ooo.0o0.ooo/2016/11/02/581965ce822a5.png)
### 3.3EditPlus
五图胜千言

![1.png](https://ooo.0o0.ooo/2016/11/02/581966fcdb2a7.png)

![2.png](https://ooo.0o0.ooo/2016/11/02/581966fc9a62f.png)

![3.png](https://ooo.0o0.ooo/2016/11/02/581966fc9d7c8.png)

![4.png](https://ooo.0o0.ooo/2016/11/02/581966fce0527.png)

![5.png](https://ooo.0o0.ooo/2016/11/02/581966fc96641.png)

## 总结
我竟然不知道EditPlus居然能连接FTP服务器,这样的话用这个东西来修改服务器配置就方便多了,不用再一点一点vim了(原谅我只会vim简单操作).

## 说明
这篇文章整理自黑马JavaEE的课程笔记中,外加了点自己的实践的东西
加油学,闪光之前总是要经历黑暗.^_^